<!DOCTYPE html>
<html>
    <head>
        <title>Escape the Ship</title>
        <link href="css/layoutDeckLifeboat.css" rel="stylesheet" type="text/css"/>
        <script type= "text/javascript">
            
            window.addEventListener('load', function() {var te = setInterval(countDown, 1000);});
            var timer = 0;
            var countContrast = 0;
            var countFontSize = 0;

            var roomVisited = false;
            
            var lever = new Audio();
            lever.src = "sound/lever.mp3";

            var name = sessionStorage.getItem('fName');
            var timeTaken = 0;
            var level = 7;
            var name = sessionStorage.getItem('transferName');

            function initialLifeboat() {
                initialOutputLifeboat();
                recieveMain();
                setSize();
                setContrast();
                setTimeout(timerHint, 20000);
            }

            function recieveMain() {
                countContrast = sessionStorage.getItem('transferContrast');
                countFontSize = sessionStorage.getItem('transferSize');
                
                timer = sessionStorage.getItem('timeLeft');
            }

            function initialOutputLifeboat() {
                document.getElementById('outputText').innerHTML += "<span class = 'player'>[" + name + "]: Finally, a way out of here! It looks like I might need some kind of tool to release the lifeboat from it's davit. Maybe there's a storage room for tools somewhere? </span>";
            }

            function countDown() {
                if(timer > 0) {

                    document.getElementById('timeLeft').innerHTML = timer;
                    timer--;
                    timeTaken++; 
                } else {
                    var PageId = level;
                    sessionStorage.setItem('PageId', PageId);
                    var transferContrast = countContrast;
                    sessionStorage.setItem('transferContrast', transferContrast);
                    var transferSize = countFontSize;
                    sessionStorage.setItem('transferSize', transferSize);
                    window.open('GameSummaryLose.html', '_self'); 
                }
             }

            function lifeboatCheckOutput() {
                
                if (roomVisited){
                    sendWin();
                }
                
                else { 
                document.getElementById('outputText').innerHTML += "<span class = 'system'><br><br>[System]: The davit appears to me missing its release mechanism - perhaps there is a spare somewhere.</span>";
                }
            }

            function toolRoomVisitedOutput() {
                if (roomVisited) {
                    document.getElementById('outputText').innerHTML += "<span class = 'player'><br><br>[" + name + "]: I've just been in there,I need to get off this ship with the lifeboat!</span>";
                }
                else {

                    document.getElementById("gameimg").useMap = "#tools";
                    var image = document.getElementById('gameimg')
                    image.src = "images/toolroom.png"

                    document.getElementById('outputText').innerHTML += "<span class = 'player'><br><br>[" + name + "]: This looks like a workshop. Perhaps I could find some form of input to actuate the lifeboat's hydraulics systems.</span>";
                    roomVisited = true;
                }
            }
            
            function leverTaken(){
                
                document.getElementById("gameimg").useMap = "#lifeboat";
                    var image = document.getElementById('gameimg')
                    image.src = "images/Life-boat-2000-x-700.jpeg"
                
                lever.play();
                
                document.getElementById('gameimg').src = "images/Life-boat-2000-x-700.jpeg";
                document.getElementById('outputText').innerHTML += "<span class = 'player'><br><br>[" + name + "]: Now I just to release that lifeboat!";
                
                
            }
            
            function timerHint() {
                
                if(!roomVisited) {
                    
                    document.getElementById("outputText").innerHTML += "<span class = 'player'><br><br>["+ name+ "]: I need to find something to help me lower this lifeboat!";
                    
                } else {
                    
                    document.getElementById("outputText").innerHTML += "<span class = 'player'><br><br>["+ name+ "]: I have to release this lifeboat before it is too late!";
                    
                }
                
            
                
            }
            
            


            function changeColour() {
            countContrast++;  
            if(countContrast % 2 === 0) {
                document.getElementById("head").style.color = "aqua";
                document.getElementById("accessibility").style.color = "aqua";
                document.getElementById("output").style.color = "aqua";
                document.getElementById("audio").style.color = "aqua";
                document.getElementById("timer").style.color = "aqua";
                document.getElementById("buttonContrast").style.color = "aqua";
                document.getElementById("buttonFont").style.color = "aqua";
                } 
            else if (countContrast % 2 === 1) {          
                document.getElementById("head").style.color = "yellow";
                document.getElementById("accessibility").style.color = "yellow";
                document.getElementById("output").style.color = "yellow";
                document.getElementById("audio").style.color = "yellow";
                document.getElementById("timer").style.color = "yellow";
                document.getElementById("buttonContrast").style.color = "yellow";
                document.getElementById("buttonFont").style.color = "yellow";          
                }
        }
            
            function changeFontSize() {
                countFontSize++;  
                if(countFontSize % 2 === 0) { 
                    document.getElementById("head").style.fontSize = "initial";
                    document.getElementById("accessibility").style.fontSize = "initial";
                    document.getElementById("output").style.fontSize = "initial";
                    document.getElementById("audio").style.fontSize = "initial";
                    document.getElementById("timer").style.fontSize = "initial";
                    document.getElementsByTagName("button").style.fontSize = "initial";
                } 

                else if (countFontSize % 2 === 1) {       
                    document.getElementById("head").style.fontSize = "x-large";
                    document.getElementById("accessibility").style.fontSize = "x-large";
                    document.getElementById("output").style.fontSize = "x-large";
                    document.getElementById("audio").style.fontSize = "x-large";
                    document.getElementById("timer").style.fontSize = "x-large";          
                }    
            }

            function sendWin() {
                var transferContrast = countContrast;
                sessionStorage.setItem('transferContrast', transferContrast);
                var transferSize = countFontSize;
                sessionStorage.setItem('transferSize', transferSize);
                var transferTime = timer;
                sessionStorage.setItem('timeLeft', transferTime);
                var timeTakenLifeboat = timeTaken;
                sessionStorage.setItem('timeTakenLifeboat', timeTakenLifeboat)
                window.open('GameSummaryWin.html', '_self'); 
            }

            function setSize() {
            if (countFontSize % 2 === 1) {            
                document.getElementById("head").style.fontSize = "x-large";
                document.getElementById("accessibility").style.fontSize = "x-large";
                document.getElementById("output").style.fontSize = "x-large";
                document.getElementById("audio").style.fontSize = "x-large";
                document.getElementById("timer").style.fontSize = "x-large";
                }  
            }

            function setContrast() {
            if(countContrast % 2 === 1) {     
                document.getElementById("head").style.color = "yellow";
                document.getElementById("accessibility").style.color = "yellow";
                document.getElementById("output").style.color = "yellow";
                document.getElementById("audio").style.color = "yellow";
                document.getElementById("timer").style.color = "yellow";
                document.getElementById("buttonContrast").style.color = "yellow";
                document.getElementById("buttonFont").style.color = "yellow";
                }
            }
        </script>
        
    </head>
    

    <body onload="initialLifeboat()">
        <div id="head">
            <h1>Final Level - Lifeboat</h1>
        </div>
            <div id="wrapper">

            <div class=row>

                <div id="game">
                    <img id="gameimg" style="width: 100%" src="images/Life-boat-2000-x-700.jpeg" alt="a lifeboat hanging off a davit - there is no release mechanism however", usemap="#lifeboat">
                        
                        <map name="lifeboat">
                            
                            <area title="Toolroom" alt="Toolroom" coords="190,150,320,300" shape="rect" href = "#" onclick="toolRoomVisitedOutput()">
                            
                            <area title="Lifeboats", alt="Lifeboats in davits", coords="450,170,950,600" shape="rect", onclick="lifeboatCheckOutput()">

                        </map>
                    
                    <map name="tools">
                            
                        
                            <area title="This lever looks useful", alt="Lever", coords="50,270,150,500", shape="rect", onclick="leverTaken()">
                        
                            
                        </map>
                    
                    
                </div>

                <div id="timer">
                         <h2>Time Remaining: <span id = "timeLeft"><i>Calculating...</i></span></h2>
                </div>

                <div id="audio">
                         <h2>Sound Effects:</h2>
                    
                        <figcaption>Ocean's Waves</figcaption>
                        <audio controls loop>   

                                <source src="sound/Ocean_Waves-Mike_Koenig-980635527.mp3">

                                Your browser does not support the audio element.

                            </audio>  

                </div>
            </div>

            <div class="row">
                <div id="output">
                    <p id="outputText"></p>
                </div>

                <div id="accessibility">
                    
                    <h2>Accessibility Options:</h2>
                    
                    <button id = "buttonContrast" onclick="changeColour()">Toggle High Contrast</button>
                    
                    <button id = "buttonFont" onclick="changeFontSize()">Toggle Font Size</button>
                </div>

            </div>

        </div>
    </body>
</html>